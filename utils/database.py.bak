from pymongo import MongoClient
import os

MONGO_URI = os.getenv("MONGO_URI")

if not MONGO_URI:
    raise RuntimeError("MONGO_URI not set")

client = MongoClient(MONGO_URI)
db = client["AdvanceMusicBot"]

# Collections
queues = db["queues"]
playlists = db["playlists"]
users = db["users"]


# ---------- QUEUE HELPERS ----------

def get_queue(chat_id: int):
    data = queues.find_one({"chat_id": chat_id})
    if not data:
        return []
    return data.get("songs", [])


def set_queue(chat_id: int, songs: list):
    queues.update_one(
        {"chat_id": chat_id},
        {"$set": {"songs": songs}},
        upsert=True
    )


def clear_queue(chat_id: int):
    queues.delete_one({"chat_id": chat_id})